<html lang="en" xmlns:th="http://www.thymeleaf.org">
<div class="layuimini-main">
    <div class="layui-form layuimini-form">
        <div class="layui-row">
            <div id="addRowHtml">
                <div class="layui-col-md12">
                    <h2 style="text-align: center;margin-bottom: 20px">美境废品回收站收据</h2>
                </div>
                <div class="layui-col-md6">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">回收客</label>
                            <div class="layui-input-inline">
                                <select name="modules" lay-verify="required" lay-search="">
                                    <option value="">选择或搜索分类</option>
                                    <option value="1">layer</option>
                                    <option value="2">form</option>
                                    <option value="3">layim</option>
                                    <option value="4">element</option>
                                    <option value="5">laytpl</option>
                                    <option value="6">upload</option>
                                    <option value="7">laydate</option>
                                    <option value="8">laypage</option>
                                    <option value="9">flow</option>
                                    <option value="10">util</option>
                                    <option value="11">code</option>
                                    <option value="12">tree</option>
                                    <option value="13">layedit</option>
                                    <option value="14">nav</option>
                                    <option value="15">tab</option>
                                    <option value="16">table</option>
                                    <option value="17">select</option>
                                    <option value="18">checkbox</option>
                                    <option value="19">switch</option>
                                    <option value="20">radio</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md6">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">收据日期</label>
                            <div class="layui-input-inline">
                                <input type="text" name="date" id="date" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4">
                        <h3 style="text-align: center;border: 1px solid #e6e6e6;">废品分类</h3>
                    </div>
                    <div class="layui-col-md4">
                        <h3 style="text-align: center;border: 1px solid #e6e6e6;">废品斤数</h3>
                    </div>
                    <div class="layui-col-md4">
                        <h3 style="text-align: center;border: 1px solid #e6e6e6;">废品金额</h3>
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4 selectClass">
                        <select name="selectUnitValue" lay-verify="required" lay-search="">
                            <option value="">选择或搜索分类</option>
                            <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                        </select>
                    </div>
                    <div class="layui-col-md4">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
                    </div>
                    <div class="layui-col-md4 amountClass">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4 selectClass">
                        <select name="selectUnitValue" lay-verify="required" lay-search="">
                            <option value="">选择或搜索分类</option>
                            <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                        </select>
                    </div>
                    <div class="layui-col-md4">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
                    </div>
                    <div class="layui-col-md4 amountClass">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4 selectClass">
                        <select name="selectUnitValue" lay-verify="required" lay-search="">
                            <option value="">选择或搜索分类</option>
                            <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                        </select>
                    </div>
                    <div class="layui-col-md4">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
                    </div>
                    <div class="layui-col-md4 amountClass">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4 selectClass">
                        <select name="selectUnitValue" lay-verify="required" lay-search="">
                            <option value="">选择或搜索分类</option>
                            <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                        </select>
                    </div>
                    <div class="layui-col-md4">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
                    </div>
                    <div class="layui-col-md4 amountClass">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4 selectClass">
                        <select name="selectUnitValue" lay-verify="required" lay-search="">
                            <option value="">选择或搜索分类</option>
                            <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                        </select>
                    </div>
                    <div class="layui-col-md4">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
                    </div>
                    <div class="layui-col-md4 amountClass">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4 selectClass">
                        <select name="selectUnitValue" lay-verify="required" lay-search="">
                            <option value="">选择或搜索分类</option>
                            <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                        </select>
                    </div>
                    <div class="layui-col-md4">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
                    </div>
                    <div class="layui-col-md4 amountClass">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4 selectClass">
                        <select name="selectUnitValue" lay-verify="required" lay-search="">
                            <option value="">选择或搜索分类</option>
                            <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                        </select>
                    </div>
                    <div class="layui-col-md4">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
                    </div>
                    <div class="layui-col-md4 amountClass">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4 selectClass">
                        <select name="selectUnitValue" lay-verify="required" lay-search="">
                            <option value="">选择或搜索分类</option>
                            <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                        </select>
                    </div>
                    <div class="layui-col-md4">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
                    </div>
                    <div class="layui-col-md4 amountClass">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4 selectClass">
                        <select name="selectUnitValue" lay-verify="required" lay-search="">
                            <option value="">选择或搜索分类</option>
                            <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                        </select>
                    </div>
                    <div class="layui-col-md4">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
                    </div>
                    <div class="layui-col-md4 amountClass">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-md4 selectClass">
                        <select name="selectUnitValue" lay-verify="required" lay-search="">
                            <option value="">选择或搜索分类</option>
                            <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                        </select>
                    </div>
                    <div class="layui-col-md4">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
                    </div>
                    <div class="layui-col-md4 amountClass">
                        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
            </div>
            <div style="float: right;margin-top: 20px">
                <span>总计金额：</span><em id="allAmount">0</em>
            </div>
        </div>
    </div>
</div>
<script id="rowHtml" type="text/html">
    <div class="layui-row">
        <div class="layui-row">
            <div class="layui-col-md4 selectClass">
                <select name="selectUnitValue" lay-verify="required" lay-search="">
                    <option value="">选择或搜索分类</option>
                    <option th:each="category : ${newCategoryList}" th:text="${category.unitName}" th:value="${category.unitValue}"></option>
                </select>
            </div>
            <div class="layui-col-md4">
                <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入斤数" class="layui-input" oninput="getInputValue(this)">
            </div>
            <div class="layui-col-md4 amountClass">
                <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="" class="layui-input">
            </div>
        </div>
    </div>
</script>
<script>
    layui.use(['form', 'table','laytpl'], function () {
        var form = layui.form,
            layer = layui.layer,
            table = layui.table,
            laydate = layui.laydate,
            laytpl = layui.laytpl,
            $ = layui.$;
        //日期
        laydate.render({
            elem: '#date'
        });
        /**
         * 初始化表单，要加上，不然刷新部分组件可能会不加载
         */
        form.render();

        // 当前弹出层，防止ID被覆盖
        var parentIndex = layer.index;

        //监听提交
        form.on('submit(saveBtn)', function (data) {
            console.log(data);
            $.ajax({
                url:'/categoryManagement/save',
                type: 'post',
                data: data.field,
                success:function (){
                    var index = layer.alert("保存成功", function () {
                        // 关闭弹出层
                        layer.close(index);
                        layer.close(parentIndex);

                    });
                },
                error:function (){
                    layer.alert("保存失败");
                }
            })
            return false;
        });

        // var getTpl = $("#rowHtml").innerHTML
        //     ,view = document.getElementById('view');
        // $("#addRow").click(function (){
        //     laytpl(getTpl).render({},function(html){
        //         // $("#addRow").innerHTML = html;
        //     });
        // })
        var data = { //数据

        }
        var getTpl = rowHtml.innerHTML
            ,view = $('#addRowHtml');
        var active = {
            addRowHtml:function () {
                laytpl(getTpl).render(data, function(html){
                    view.append(html);
                    form.render();
                });
            }
        }
        window.parent._active = active;
    });
   var $ = layui.$;
    function getInputValue(that){
        var numValue = $(that).val();
        var unitValue = $(that).parents().siblings(".selectClass").children().val();
        $(that).parents().siblings(".amountClass").children().val((numValue*100)*(unitValue*100)/10000);
        var allAmount=0;
        $(".layui-row").children(".amountClass").each(function (){
            var amount = $(this).children().val();
            allAmount=allAmount+amount*10000;
        })
        $("#allAmount").html(allAmount/10000);
    }
</script>
